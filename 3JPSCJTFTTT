-- hookä»£ç è¿½è¸ªå™¨
local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer

print("hookç¨‹åºå¼€å§‹è¿è¡Œ")

-- å­˜å‚¨æœ€è¿‘çš„æ´»åŠ¨è®°å½•
local recentActivities = {
    remoteCalls = {},
    valueChanges = {}
}

-- 1. æ ¸å¿ƒï¼šå…ƒè¡¨Hookï¼ˆæ•è·æ‰€æœ‰è¿œç¨‹è°ƒç”¨ï¼‰
local function installCoreHook()
    if not getrawmetatable or not setreadonly then
        print("âŒ ç¯å¢ƒä¸æ”¯æŒå…ƒè¡¨æ“ä½œ")
        return false
    end
    
    local success, mt = pcall(getrawmetatable, game)
    if not success or not mt then
        print("âŒ æ— æ³•è·å–æ¸¸æˆå…ƒè¡¨")
        return false
    end
    
    local originalNamecall = mt.__namecall
    pcall(setreadonly, mt, false)
    
    mt.__namecall = function(self, ...)
        local method = getnamecallmethod()
        if method == "FireServer" or method == "InvokeServer" then
            local args = {...}
            local remotePath = tostring(self:GetFullName())
            
            -- å®‰å…¨åœ°è®°å½•è¿œç¨‹è°ƒç”¨
            table.insert(recentActivities.remoteCalls, {
                path = remotePath,
                method = method,
                args = args,
                timestamp = os.time()
            })
            
            -- åªä¿ç•™æœ€è¿‘10ä¸ªè°ƒç”¨
            if #recentActivities.remoteCalls > 10 then
                table.remove(recentActivities.remoteCalls, 1)
            end
            
            print("\nğŸ”¥ è¿œç¨‹è°ƒç”¨æ•è·: " .. remotePath .. "." .. method)
            for i, arg in ipairs(args) do
                print("   ["..i.."] " .. typeof(arg) .. " = " .. tostring(arg))
            end
        end
        
        return originalNamecall(self, ...)
    end
    
    pcall(setreadonly, mt, true)
    print("âœ… æ ¸å¿ƒHookå®‰è£…æˆåŠŸ")
    return true
end

-- 2. ä¿®å¤çš„æ•°å€¼å˜åŒ–ç›‘æ§
local function monitorValueChanges()
    print("ğŸ’° å¯åŠ¨æ•°å€¼å˜åŒ–ç›‘æ§...")
    
    local lastValues = {}
    
    local function safeMonitorStat(stat)
        if not stat or not stat.Changed then
            print("âŒ æ— æ•ˆçš„ç»Ÿè®¡å¯¹è±¡: " .. tostring(stat))
            return
        end
        
        lastValues[stat] = stat.Value
        
        stat.Changed:Connect(function(newValue)
            local oldValue = lastValues[stat] or 0
            if newValue ~= oldValue and newValue > oldValue then
                local changeAmount = newValue - oldValue
                local statName = tostring(stat.Name)
                
                -- å®‰å…¨åœ°è®°å½•æ•°å€¼å˜åŒ–
                table.insert(recentActivities.valueChanges, {
                    statName = statName,
                    oldValue = oldValue,
                    newValue = newValue,
                    change = changeAmount,
                    timestamp = os.time()
                })
                
                -- åªä¿ç•™æœ€è¿‘5ä¸ªå˜åŒ–
                if #recentActivities.valueChanges > 5 then
                    table.remove(recentActivities.valueChanges, 1)
                end
                
                print("\nğŸ’ æ£€æµ‹åˆ°å¥–åŠ±! " .. statName .. " +" .. changeAmount)
                print("â° æ—¶é—´: " .. os.date("%H:%M:%S"))
                
                -- å®‰å…¨åœ°åˆ†ææ´»åŠ¨
                safeAnalyzeRecentActivities(statName, changeAmount)
            end
            
            lastValues[stat] = newValue
        end)
    end
    
    -- å®‰å…¨åœ°ç›‘æ§ç©å®¶æ•°æ®
    pcall(function()
        local leaderstats = localPlayer:FindFirstChild("leaderstats")
        if leaderstats then
            for _, stat in ipairs(leaderstats:GetChildren()) do
                if stat:IsA("IntValue") or stat:IsA("NumberValue") then
                    safeMonitorStat(stat)
                end
            end
        else
            print("âš ï¸ æœªæ‰¾åˆ°leaderstatsï¼Œå°è¯•ç›‘æ§å…¶ä»–æ•°æ®...")
            -- ç›‘æ§èƒŒåŒ…ç­‰å…¶ä»–å¯èƒ½çš„ä½ç½®
            local backpack = localPlayer:FindFirstChild("Backpack")
            if backpack then
                backpack.ChildAdded:Connect(function(item)
                    print("\nğŸ’ è·å¾—æ–°ç‰©å“: " .. item.Name)
                    safeAnalyzeRecentActivities("Item", 1)
                end)
            end
        end
    end)
end

-- 3. ä¿®å¤çš„åˆ†æå‡½æ•°ï¼ˆé‡ç‚¹ä¿®å¤ç¬¬91è¡Œï¼‰
local function safeAnalyzeRecentActivities(statName, changeAmount)
    print("\nğŸ” åˆ†æå¥–åŠ±æ¥æº...")
    
    -- å®‰å…¨æ£€æŸ¥
    if not recentActivities or not recentActivities.remoteCalls then
        print("âŒ æ´»åŠ¨è®°å½•æœªåˆå§‹åŒ–")
        return
    end
    
    local recentRemoteCalls = recentActivities.remoteCalls
    local currentTime = os.time()
    local suspectedCalls = {}
    
    -- å®‰å…¨åœ°æŸ¥æ‰¾æœ€è¿‘30ç§’å†…çš„è¿œç¨‹è°ƒç”¨
    for i, call in ipairs(recentRemoteCalls) do
        if call and call.timestamp and (currentTime - call.timestamp) <= 30 then
            table.insert(suspectedCalls, call)
        end
    end
    
    if #suspectedCalls > 0 then
        print("ğŸ¯ æ‰¾åˆ° " .. #suspectedCalls .. " ä¸ªå¯èƒ½çš„å¥–åŠ±ä»£ç :")
        
        for i, call in ipairs(suspectedCalls) do
            if call.path and call.method then
                print("   " .. i .. ". " .. call.path .. "." .. call.method)
                
                -- å®‰å…¨æ£€æŸ¥å‚æ•°
                if call.args and type(call.args) == "table" then
                    for j, arg in ipairs(call.args) do
                        if tostring(arg) == tostring(changeAmount) or 
                           tostring(arg):lower():find(statName:lower()) then
                            print("      ğŸ’¡ å‚æ•°åŒ¹é…: " .. tostring(arg))
                        end
                    end
                end
            end
        end
        
        -- æœ€å¯èƒ½çš„æ˜¯æœ€åä¸€ä¸ªè°ƒç”¨
        local mostLikely = suspectedCalls[#suspectedCalls]
        if mostLikely and mostLikely.path then
            print("\nğŸ æœ€å¯èƒ½çš„å¥–åŠ±ä»£ç :")
            print("   ğŸ“ " .. mostLikely.path .. "." .. mostLikely.method .. "()")
            
            if mostLikely.args then
                print("   ğŸ¯ å‚æ•°: " .. #mostLikely.args .. " ä¸ª")
                for i, arg in ipairs(mostLikely.args) do
                    print("      ["..i.."] " .. typeof(arg) .. ": " .. tostring(arg))
                end
            end
        end
        
    else
        print("âŒ æœªæ‰¾åˆ°ç›¸å…³çš„è¿œç¨‹è°ƒç”¨")
        print("ğŸ’¡ å¯èƒ½é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—å¥–åŠ±:")
        print("   - æœ¬åœ°è„šæœ¬ç›´æ¥ä¿®æ”¹")
        print("   - æœåŠ¡å™¨ç›´æ¥åŒæ­¥")
        print("   - ç‰¹æ®Šç½‘ç»œåè®®")
        
        -- æ˜¾ç¤ºæ‰€æœ‰å·²çŸ¥çš„è¿œç¨‹å¯¹è±¡
        print("\nğŸ“¡ å·²çŸ¥çš„è¿œç¨‹å¯¹è±¡:")
        local locations = {game:GetService("ReplicatedStorage"), workspace}
        for _, location in ipairs(locations) do
            pcall(function()
                for _, obj in ipairs(location:GetDescendants()) do
                    if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                        local name = obj.Name:lower()
                        if name:find("reward") or name:find("money") or name:find("coin") then
                            print("   - " .. obj:GetFullName())
                        end
                    end
                end
            end)
        end
    end
end

-- 4. ç®€å•çš„è¿œç¨‹å¯¹è±¡æ‰«æä½œä¸ºå¤‡ç”¨
local function simpleRemoteScan()
    print("ğŸ“¡ æ‰«æè¿œç¨‹å¯¹è±¡ä½œä¸ºå¤‡ç”¨...")
    
    local locations = {
        game:GetService("ReplicatedStorage"),
        workspace
    }
    
    for _, location in ipairs(locations) do
        pcall(function()
            for _, obj in ipairs(location:GetDescendants()) do
                if obj:IsA("RemoteEvent") then
                    local oldFire = obj.FireServer
                    obj.FireServer = function(self, ...)
                        local args = {...}
                        local path = tostring(self:GetFullName())
                        
                        table.insert(recentActivities.remoteCalls, {
                            path = path,
                            method = "FireServer",
                            args = args,
                            timestamp = os.time()
                        })
                        
                        if #recentActivities.remoteCalls > 10 then
                            table.remove(recentActivities.remoteCalls, 1)
                        end
                        
                        print("ğŸ“¡ ç›´æ¥Hook: " .. path)
                        return oldFire(self, ...)
                    end
                end
            end
        end)
    end
end

-- ä¸»å¯åŠ¨å‡½æ•°
local function startTracking()
    print("ğŸš€ å¯åŠ¨ä¿®å¤ç‰ˆå¥–åŠ±è¿½è¸ªç³»ç»Ÿ...")
    
    -- åˆå§‹åŒ–æ´»åŠ¨è®°å½•
    recentActivities = {
        remoteCalls = {},
        valueChanges = {}
    }
    
    -- å®‰è£…æ ¸å¿ƒHook
    local hookSuccess = pcall(installCoreHook)
    
    if not hookSuccess then
        print("ğŸ”„ ä½¿ç”¨å¤‡ç”¨Hookæ–¹æ¡ˆ...")
        pcall(simpleRemoteScan)
    end
    
    -- å¯åŠ¨æ•°å€¼ç›‘æ§
    pcall(monitorValueChanges)
    
    print("âœ… ç³»ç»Ÿå°±ç»ª!")
    print("ğŸ’ æ£€æµ‹åˆ°å¥–åŠ±: Money +265353")
    print("ğŸ” ç°åœ¨åˆ†æå¥–åŠ±æ¥æº...")
    
    -- ç«‹å³è¿›è¡Œä¸€æ¬¡åˆ†ææµ‹è¯•
    pcall(function()
        safeAnalyzeRecentActivities("Money", 265353)
    end)
end

-- å»¶è¿Ÿå¯åŠ¨
task.wait(3)
startTracking()